generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id             Int              @id @default(autoincrement())
  name           String
  description    String
  msrpPrice      Float
  currentPrice   Float             @default(0.0)
  onSale         Boolean           @default(false)
  images         ProductImage[]
  brand          String
  model          String
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  archived       Boolean           @default(false)
  variants       ProductVariant[]
  reviews        Review[]
  inventory      Inventory[]
  sales          Sale[]            @relation("ProductSales")
  categories     Category[]        @relation("ProductCategories")
  subcategories  SubCategory[]     @relation("ProductSubCategories")
  sizes          Size[]
  isSingleSize   Boolean           @default(false)
  quantity       Int?
  packages       Package[]         @relation("ProductPackages")
  orderItems     OrderItem[]
  cartItems      CartItem[]
}

model ProductVariant {
  id             Int              @id @default(autoincrement())
  name           String
  msrpPrice      Float
  currentPrice   Float             @default(0.0)
  productId      Int
  product        Product           @relation(fields: [productId], references: [id])
  isSingleSize   Boolean           @default(false)
  quantity       Int?
  sizes          Size[]
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  archived       Boolean           @default(false)
  images         ProductImage[]
  sales          Sale[]            @relation("VariantSales")
  orderItems     OrderItem[]
  cartItems      CartItem[]
  inventory      Inventory[]
}

model Size {
  id             Int              @id @default(autoincrement())
  size           String
  quantity       Int
  productId      Int?
  product        Product?          @relation(fields: [productId], references: [id])
  variantId      Int?
  variant        ProductVariant?   @relation(fields: [variantId], references: [id])
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  cartItems      CartItem[]
}

model ProductImage {
  id             Int              @id @default(autoincrement())
  url            String
  order          Int
  productVariantId Int?
  productVariant ProductVariant?   @relation(fields: [productVariantId], references: [id])
  productId      Int?
  product        Product?          @relation(fields: [productId], references: [id])
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
}

model Category {
  id             Int              @id @default(autoincrement())
  name           String
  description    String?
  products       Product[]         @relation("ProductCategories")
  subcategories  SubCategory[]
}

model SubCategory {
  id             Int              @id @default(autoincrement())
  name           String
  description    String?
  categoryId     Int
  category       Category          @relation(fields: [categoryId], references: [id])
  products       Product[]         @relation("ProductSubCategories")
}

model User {
  id             Int              @id @default(autoincrement())
  email          String           @unique
  password       String
  name           String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  orders         Order[]
  reviews        Review[]
  cart           Cart?
}

model Order {
  id             Int              @id @default(autoincrement())
  userId         Int
  user           User             @relation(fields: [userId], references: [id])
  totalAmount    Float
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
  orderItems     OrderItem[]
}

model OrderItem {
  id             Int              @id @default(autoincrement())
  orderId        Int
  order          Order            @relation(fields: [orderId], references: [id])
  productId      Int
  product        Product          @relation(fields: [productId], references: [id])
  variantId      Int?
  variant        ProductVariant?  @relation(fields: [variantId], references: [id])
  quantity       Int
  price          Float
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
}

model Review {
  id             Int              @id @default(autoincrement())
  userId         Int
  user           User             @relation(fields: [userId], references: [id])
  productId      Int
  product        Product          @relation(fields: [productId], references: [id])
  rating         Float
  comment        String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
}

model Cart {
  id             Int              @id @default(autoincrement())
  userId         Int              @unique
  user           User             @relation(fields: [userId], references: [id])
  items          CartItem[]
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
}

model CartItem {
  id             Int              @id @default(autoincrement())
  cartId         Int
  cart           Cart             @relation(fields: [cartId], references: [id])
  productId      Int
  product        Product          @relation(fields: [productId], references: [id])
  variantId      Int?
  variant        ProductVariant?  @relation(fields: [variantId], references: [id])
  sizeId         Int?
  size           Size?            @relation(fields: [sizeId], references: [id])
  cartQuantity   Int
  currentPrice   Float
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
}

model Inventory {
  id             Int              @id @default(autoincrement())
  productId      Int?
  product        Product?          @relation(fields: [productId], references: [id])
  variantId      Int?
  variant        ProductVariant?   @relation(fields: [variantId], references: [id])
  quantity       Int
  updatedAt      DateTime          @default(now())
}

model Sale {
  id             Int              @id @default(autoincrement())
  name           String
  title          String
  tagline        String
  startDate      DateTime
  endDate        DateTime
  salePercentage Float?
  saleAmount     Float?
  archived       Boolean           @default(false)
  products       Product[]         @relation("ProductSales")
  variants       ProductVariant[]  @relation("VariantSales")
  promoCodes     PromoCode[]
}

model PromoCode {
  id             Int              @id @default(autoincrement())
  code           String           @unique
  validFrom      DateTime
  validTo        DateTime
  saleId         Int
  sale           Sale             @relation(fields: [saleId], references: [id])
}

model Package {
  id             Int              @id @default(autoincrement())
  name           String
  description    String
  price          Float
  products       Product[]         @relation("ProductPackages")
}
